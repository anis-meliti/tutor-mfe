# MFE apps
{% for app in iter_values_named(suffix="MFE_APP") %}
{{ app["name"] }}:
    image: {{ app["name"] }}
    build:
        context: ../plugins/mfe/build/mfe/
        target: {{ app["name"] }}-dev
    ports:
        - "127.0.0.1:{{ app["port"] }}:{{ app["port"] }}"
    {# Unfortunately we can't rely on "npm run start" because we need to manually disable host checking, which defaults to localhost/0.0.0.0.#}
    {# command: ["npm", "run", "start"] #}
    command: ["fedx-scripts", "webpack-dev-server"]
    volumes:
        - ../plugins/mfe/apps/mfe/webpack.dev.config.js:/openedx/app/webpack.dev.config.js:ro
    env_file:
        - ../plugins/mfe/build/mfe/env/production
        - ../plugins/mfe/build/mfe/env/development
    {% if "env" in app %}
    environment:
        - "PORT={{ app['port'] }}"
    {% if "production" in app["env"] %}{% for key, value in app["env"]["production"].items() %}
        - "{{ key }}={{ value }}"
    {% endfor %}{% endif %}
    {% if "development" in app["env"] %}{% for key, value in app["env"]["development"].items() %}
        - "{{ key }}={{ value }}"
    {% endfor %}{% endif %}
    {% endif %}
{% endfor %}
